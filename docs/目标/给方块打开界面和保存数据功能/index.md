---
layout: default
title: 给方块打开界面和保存数据功能
parent: 目标
nav_order: 2
has_children: true
---

# 给方块打开界面和保存数据功能


**功能**

右键打开方块，显示一个输入框，信息永久保存



**定义显示什么**

这里的核心类是GuiScreen和Container



GuiScreen定义如何显示一个界面，就像jei右边显示物品列表，显示各种按钮

如果你打开的界面不需要存放物品，就不需要用到Container，就像是矿透，jei，血条mod等

因为他们不需要和服务器数据交换，服务器根本不知道你装了这些mod



只要是涉及物品的保存，mc通常都会提供相应的类和机制

如果你是熔炉这种，里面放有物品的界面，就要使用Container

Container定义有多少个格子，是熔炉就3个，是箱子就更多。因为重新进入世界熔炉里面的东西不会消失，所以Container有数据保存功能

使用GuiContainer 绑定GuiScreen和Container，注册IGuiHandler设置服务端和客户端的不同逻辑等



我这里不保存物品，所以只用GuiScreen，不用Container



**方块保存数据的机制**

nbt： nbt是mc使用的数据格式，通过内部机制使用nbt作为介质实现数据的保存到存档永久保存，服务器同步数据到客户端等。
使用nbt的机制肯定是有性能损耗，像是草方块等基础方块没有存储额外信息也就没有nbt。想象一下一个区块w级别数量的方块，如果全是实体tileentity那得有多卡。



上一步我们定义了一个方块，现在我们要给它添加功能

使用到TileEntity，TileEntity可以理解为各种功能的合集，通过给一个方块设置TileEntity，赋予这个方块各种能力。



**数据包**

mc分为服务端客户端，当你进入一个服务器，你的电脑和服务器之间当然得进行通信

只要涉及数据的基本都是由一服务端为准，数据包就是作为信息发送载体

比如告诉服务器你挖掘了什么方块，你得发送一个数据包给服务器，服务器判断谁要干什么，验证这个数据包是否本人发送的，这个动作是否有权利执行

当然挖方块这种原版机制肯定是不需要我们写数据包, 我们添加自己的功能的时候就需要写数据包了

通常在服务器接收这个请求并处理后，需要同步处理结果给客户端。如果你是使用nbt机制，mc就会自动同步





**流程**

右键点击方块 -> 打开guiscreen -> 输入信息 -> 保存并退出界面 -> 客户端发送数据包到服务器保存数据

-> 通过nbt机制保存数据到存档，永久保存 -> 通过nbt机制服务器自动同步数据到客户端



