---
layout: default
title: 给方块打开界面和保存数据功能
parent: 目标
nav_order: 2
has_children: true
---

# 给方块打开界面和保存数据功能


**功能**

右键打开方块，显示一个输入框，信息永久保存



**定义显示什么**

这里的核心类是GuiScreen和Container



GuiScreen定义如何显示一个界面，就像jei右边显示物品列表，显示各种按钮

如果你打开的界面不需要存放物品，就不需要用到Container



只要是涉及物品的保存，通常都需要使用mc提供提供的相应的类和机制

如果你是熔炉这种，里面放有物品的界面，就要使用Container

Container定义有多少个格子，是熔炉就3个，是箱子就更多。因为重新进入世界熔炉里面的东西不会消失，所以Container有数据保存功能

使用GuiContainer 绑定GuiScreen和Container，注册IGuiHandler设置服务端和客户端的不同逻辑等



我这里不保存物品，所以只用GuiScreen，不用Container



**方块保存数据的机制**

nbt： nbt是mc使用的数据格式，通过内部机制使用nbt作为介质实现数据的保存到存档永久保存，服务器同步数据到客户端等。
使用nbt的机制肯定是有性能损耗，像是草方块等基础方块没有存储额外信息也就没有nbt。



上一步我们定义了一个方块，现在我们要给它添加功能

使用到TileEntity，TileEntity可以理解为各种功能的合集，通过给一个方块设置TileEntity，赋予这个方块各种能力。



**数据包**

java层面的数据包

客户端可以干一些事不告诉服务端, 比如矿透, 只要不涉及数据保存到存档

你要你想修改需要保存到存档的数据, 都要发数据包给服务器

需要我们自定义数据包的是mc不存在的额外逻辑, 像是copy一个熔炉只需要用到Container不用数据包



**流程**

-> 保存并退出界面 -> 客户端发送数据包到服务器保存数据





**流程**

右键点击方块 -> 打开guiscreen -> 输入信息 -> 保存并退出界面 -> 客户端发送数据包到服务器保存数据

-> 通过nbt机制保存数据到存档，永久保存 -> 通过nbt机制服务器自动同步数据到客户端



